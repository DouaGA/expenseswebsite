{% extends 'base_auth.html' %}
{% load static %}

{% block auth_content %}
<!-- Animation de fond -->
<div class="bg-animation"></div>
<div class="leaves-container" id="leaves"></div>

<main class="d-flex align-items-center min-vh-100 py-4">
    <div class="container">
        <div class="row justify-content-center">
            <!-- Section projet (gauche) -->
            <div class="col-lg-5 col-md-6 mb-4 mb-lg-0">
                <div class="card auth-card h-100">
                    <div class="card-body p-4 p-md-5">
                        <h2 class="text-center mb-4" style="color: var(--primary);">GreenMap</h2>
                        <h4 class="text-center mb-4">Say Stop to the Pollution</h4>
                        <p class="text-center mb-4">Plateforme citoyenne de signalement des pollutions environnementales</p>
                        
                        <ul class="list-unstyled mt-4">
                            <li class="mb-3"><i class="fas fa-check-circle text-success me-2"></i> Cartographie interactive</li>
                            <li class="mb-3"><i class="fas fa-check-circle text-success me-2"></i> Alertes pollution en temps réel</li>
                            <li class="mb-3"><i class="fas fa-check-circle text-success me-2"></i> Communauté engagée</li>
                            <li><i class="fas fa-check-circle text-success me-2"></i> Suivi des nettoyages</li>
                        </ul>
                    </div>
                </div>
            </div>
            
            <!-- Section connexion (droite) -->
            <div class="col-lg-5 col-md-6">
                <div class="card auth-card">
                    <div class="auth-header">
                        <div class="auth-logo-container">
                            GM
                        </div>
                        <div class="auth-header-text">
                            <h4>GM Connexion</h4>
                        </div>
                    </div>
                    <div class="card-body p-4 p-md-5">
                        <p class="text-danger text-center mb-3">
                            <i class="fas fa-times me-2"></i> Vous avez été déconnecté
                        </p>
                        
                        {% include 'partials/_messages.html' %}
                        
                        <form method="post" action="{% url 'login' %}">
                            {% csrf_token %}
                            <input type="hidden" name="next" value="{{ next|default:'/' }}">
                            
                            <div class="mb-3">
                                <label for="username" class="form-label">Nom d'utilisateur</label>
                                <input type="text" class="form-control" id="username" name="username" 
                                       placeholder="bnj" required autofocus>
                            </div>
                            
                            <div class="mb-3">
                                <label for="password" class="form-label">Mot de passe</label>
                                <input type="password" class="form-control" id="password" name="password" 
                                       placeholder="••••••••" required>
                            </div>
                            
                            <div class="d-flex justify-content-between align-items-center mb-4">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="remember" name="remember">
                                    <label class="form-check-label" for="remember">Se souvenir de moi</label>
                                </div>
                                <a href="{% url 'password_reset' %}" class="text-decoration-none">Mot de passe oublié ?</a>
                            </div>
                            
                            <div class="d-grid mb-3">
                                <button type="submit" class="btn btn-primary btn-lg">Se connecter</button>
                            </div>
                            
                            <div class="text-center pt-3">
                                <p class="mb-0">Pas encore de compte ? <a href="{% url 'register' %}" class="text-decoration-none">S'inscrire</a></p>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</main>

<script>
// Création des feuilles qui tombent
function createLeaves() {
    const container = document.getElementById('leaves');
    const leafCount = window.innerWidth < 768 ? 10 : 20;
    
    const leafTypes = [
        'M12,2C6.5,2,2,6.5,2,12s4.5,10,10,10s10-4.5,10-10S17.5,2,12,2z M12,20c-4.4,0-8-3.6-8-8s3.6-8,8-8s8,3.6,8,8 S16.4,20,12,20z',
        'M12,2C6.5,2,2,6.5,2,12s4.5,10,10,10s10-4.5,10-10S17.5,2,12,2z M7.1,15.1c-0.3-0.3-0.3-0.8,0-1.1c0.3-0.3,0.8-0.3,1.1,0 c0.3,0.3,0.3,0.8,0,1.1C7.9,15.4,7.4,15.4,7.1,15.1z M10,13c-0.6,0-1-0.4-1-1s0.4-1,1-1s1,0.4,1,1S10.6,13,10,13z M15,13 c-0.6,0-1-0.4-1-1s0.4-1,1-1s1,0.4,1,1S15.6,13,15,13z'
    ];
    
    const leafColors = ['#2E8B57', '#3CB371', '#8FBC8F'];
    
    for (let i = 0; i < leafCount; i++) {
        const leaf = document.createElement('div');
        leaf.className = 'leaf';
        
        const startX = Math.random() * 100;
        const endX = startX + (Math.random() * 40 - 20);
        const size = 15 + Math.random() * 30;
        const duration = 10 + Math.random() * 20;
        const delay = Math.random() * 15;
        const leafType = leafTypes[Math.floor(Math.random() * leafTypes.length)];
        const leafColor = leafColors[Math.floor(Math.random() * leafColors.length)];
        
        leaf.innerHTML = `
            <svg width="${size}" height="${size}" viewBox="0 0 24 24" fill="${leafColor}">
                <path d="${leafType}"/>
            </svg>
        `;
        
        leaf.style.setProperty('--end-x', `${endX}%`);
        leaf.style.left = `${startX}%`;
        leaf.style.animationDuration = `${duration}s`;
        leaf.style.animationDelay = `${delay}s`;
        
        container.appendChild(leaf);
    }
}

document.addEventListener('DOMContentLoaded', createLeaves);
window.addEventListener('resize', function() {
    document.getElementById('leaves').innerHTML = '';
    createLeaves();
});
</script>

<style>
/* Styles spécifiques pour cette mise en page */
.auth-logo-container {
    width: 50px;
    height: 50px;
    background-color: white;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    font-size: 1.5rem;
    color: var(--primary);
}

.auth-header {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 15px;
    padding: 1.5rem;
}

.auth-header-text h4 {
    margin: 0;
    color: white;
}

.text-danger {
    color: var(--secondary);
}

.form-control::placeholder {
    color: #aaa;
    opacity: 1;
}
</style>
{% endblock %}